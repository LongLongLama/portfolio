---
const dragonImageURL = `${import.meta.env.BASE_URL}img/dragon.svg`;
const writerURL = `${import.meta.env.BASE_URL}writer/`;
---

<div class="flex flex-col items-center justify-center h-full text-center">
    <img
        src={dragonImageURL}
        alt="Illustrazione di un drago"
        width="200"
        class="mb-8 drop-shadow-[0_5px_15px_rgba(14,165,233,0.4)]"
    />

    <p class="text-xl dark:text-gray-300 text-zinc-700 mb-6">
        ...forse non sei qui per il codice?
    </p>

    <button
        id="trigger-button"
        data-redirect-url={writerURL}
        class="px-6 py-3 font-bold rounded-lg shadow-lg
            transition-all duration-200 transform hover:scale-105
            
            <!-- Stile Writer (light) -->
            bg-blue-600 hover:bg-blue-700 text-white
            
            <!-- Stile Coder (dark) -->
            dark:bg-sky-500 dark:hover:bg-sky-600 dark:text-white"
    >
        Portami altrove
    </button>
</div>

<script>
    const button = document.getElementById(
        "trigger-button",
    ) as HTMLButtonElement;
    if (button) {
        const handleClick = () => {
            button.disabled = true;
            button.textContent = "In viaggio...";

            const redirectUrl = button.dataset.redirectUrl;

            document.dispatchEvent(new CustomEvent("trigger-dragon"));
            document.addEventListener(
                "dragon-animation-finished",
                () => {
                    if (redirectUrl) {
                        window.location.href = redirectUrl;
                    }
                },
                { once: true },
            );
        };
        button.addEventListener("click", handleClick);
    }

    window.addEventListener("pageshow", (event) => {
        if (event.persisted) {
            const buttonOnShow = document.getElementById(
                "trigger-button",
            ) as HTMLButtonElement;
            if (buttonOnShow) {
                buttonOnShow.disabled = false;
                buttonOnShow.textContent = "Portami altrove";
            }
        }
    });
</script>
